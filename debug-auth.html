<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { margin: 5px; padding: 10px 15px; }
    </style>
</head>
<body>
    <h1>Authentication Debug Tool</h1>
    
    <div class="debug-section">
        <h2>Current localStorage Contents</h2>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <pre id="localStorageOutput"></pre>
    </div>
    
    <div class="debug-section">
        <h2>Authentication Test</h2>
        <button onclick="testAuth()">Test Authentication</button>
        <pre id="authOutput"></pre>
    </div>
    
    <div class="debug-section">
        <h2>Create Test User</h2>
        <button onclick="createTestUser()">Create Test User</button>
        <button onclick="clearAllUserData()">Clear All User Data</button>
    </div>
    
    <script>
        function checkLocalStorage() {
            const output = document.getElementById('localStorageOutput');
            const allKeys = Object.keys(localStorage);
            const userKeys = allKeys.filter(key => 
                key.includes('kajopo') || 
                key.includes('user') || 
                key.includes('User')
            );
            
            let result = `All localStorage keys (${allKeys.length}): ${allKeys.join(', ')}\n\n`;
            result += `User-related keys (${userKeys.length}): ${userKeys.join(', ')}\n\n`;
            
            userKeys.forEach(key => {
                const value = localStorage.getItem(key);
                result += `${key}: ${value}\n\n`;
            });
            
            output.textContent = result;
        }
        
        function testAuth() {
            const output = document.getElementById('authOutput');
            
            // Test the same logic as in the pages
            const userData = localStorage.getItem('kajopo_current_user') || localStorage.getItem('kajopo_user');
            
            let result = `Testing authentication logic:\n`;
            result += `kajopo_current_user: ${localStorage.getItem('kajopo_current_user')}\n`;
            result += `kajopo_user: ${localStorage.getItem('kajopo_user')}\n`;
            result += `Combined userData: ${userData}\n\n`;
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    result += `Parsed user data: ${JSON.stringify(user, null, 2)}\n`;
                    result += `Should show user menu: YES\n`;
                } catch (error) {
                    result += `Error parsing user data: ${error.message}\n`;
                    result += `Should show user menu: NO (parse error)\n`;
                }
            } else {
                result += `No user data found\n`;
                result += `Should show user menu: NO\n`;
            }
            
            output.textContent = result;
        }
        
        function createTestUser() {
            const testUser = {
                id: 'test_user_123',
                firstName: 'Michael',
                lastName: 'Chen',
                email: 'michael.chen@example.com',
                accountType: 'seeker',
                isVerified: true
            };
            
            localStorage.setItem('kajopo_current_user', JSON.stringify(testUser));
            alert('Test user created! Check authentication now.');
            checkLocalStorage();
            testAuth();
        }
        
        function clearAllUserData() {
            const allKeys = Object.keys(localStorage);
            const userKeys = allKeys.filter(key => 
                key.includes('kajopo') || 
                key.includes('user') || 
                key.includes('User')
            );
            
            userKeys.forEach(key => localStorage.removeItem(key));
            alert(`Cleared ${userKeys.length} user-related keys`);
            checkLocalStorage();
            testAuth();
        }
        
        // Auto-run on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLocalStorage();
            testAuth();
        });
    </script>
</body>
</html>