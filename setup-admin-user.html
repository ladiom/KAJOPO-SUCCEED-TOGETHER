<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Admin Users Table - Kájọpọ̀ Connect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Setup Admin Users Table</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Database Setup</h2>
            <button id="setupTable" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-4" disabled>Table Already Exists ✓</button>
            <button id="seedData" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Sample Admin</button>
        </div>
        
        <div id="output" class="bg-gray-800 text-green-400 p-4 rounded font-mono text-sm min-h-32">
            Ready to setup admin users table...
        </div>
    </div>
    
    <script src="js/supabase-config.js"></script>
    <script>
        let output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += message + '\\n';
            output.scrollTop = output.scrollHeight;
        }
        
        // Initialize admin client with service role
        let adminClient;
        
        document.addEventListener('DOMContentLoaded', () => {
            output.innerHTML = 'Ready to setup admin users table...\\n';
            log('✓ admin_users table already exists in database');
            
            // Initialize admin client with service role key
            if (window.supabaseConfig) {
                adminClient = window.supabase.createClient(
                    window.supabaseConfig.url, 
                    window.supabaseConfig.serviceKey
                );
                log('✓ Admin client initialized with service role');
            }
            
            log('Click "Add Sample Admin" to create your first admin user');
        });
        
        document.getElementById('seedData').addEventListener('click', async () => {
            log('Adding sample admin user...');
            
            try {
                if (!adminClient) {
                    throw new Error('Admin client not initialized');
                }
                
                const { data, error } = await adminClient
                    .from('admin_users')
                    .insert([
                        {
                            email: 'admin@kajopo.com',
                            password_hash: 'Admin123!', // In production, this should be properly hashed
                            firstName: 'System',
                            lastName: 'Administrator',
                            role: 'super_admin',
                            permissions: ['users', 'opportunities', 'applications', 'analytics', 'settings', 'admin_management']
                        }
                    ]);
                
                if (error) {
                    throw error;
                }
                
                log('✓ Sample admin user created!');
                log('Email: admin@kajopo.com');
                log('Password: Admin123!');
                log('You can now use these credentials to login to the admin dashboard.');
            } catch (error) {
                log('Error: ' + error.message);
                if (error.message.includes('duplicate key')) {
                    log('Note: Admin user may already exist. Try logging in with admin@kajopo.com / Admin123!');
                } else if (error.message.includes('policy')) {
                    log('RLS Policy Error: Using service role key to bypass security policies.');
                }
            }
        });
    </script>
</body>
</html>