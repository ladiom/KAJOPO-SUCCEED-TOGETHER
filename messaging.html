<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages - K√°j·ªçp·ªçÃÄ Succeed Together</title>
    <!-- Theme System -->
    <link rel="stylesheet" href="css/themes.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--color-primary);
            color: var(--text-inverse);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle-header {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .messaging-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .conversations-sidebar {
            width: 350px;
            border-right: 1px solid #e1e8ed;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e1e8ed;
            background: white;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .conversation-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e1e8ed;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .conversation-item:hover {
            background: white;
        }

        .conversation-item.active {
            background: white;
            border-right: 3px solid #3498db;
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .conversation-preview {
            color: #7f8c8d;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .conversation-time {
            color: #95a5a6;
            font-size: 12px;
        }

        .unread-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e1e8ed;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .chat-user-details h3 {
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .chat-user-status {
            color: #27ae60;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #27ae60;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-btn {
            background: #f8f9fa;
            border: 1px solid #e1e8ed;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .chat-btn:hover {
            background: #e9ecef;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .message.sent .message-avatar {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .message-content {
            max-width: 70%;
        }

        .message-bubble {
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .message.sent .message-bubble {
            background: #3498db;
            color: white;
        }

        .message-text {
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
            text-align: right;
        }

        .message.sent .message-time {
            color: rgba(255,255,255,0.8);
        }

        .message-input-area {
            padding: 20px;
            border-top: 1px solid #e1e8ed;
            background: white;
        }

        .message-input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            min-height: 45px;
            max-height: 120px;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            resize: none;
            font-family: inherit;
            transition: all 0.3s;
        }

        .message-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .send-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .send-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            text-align: center;
            padding: 40px;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .typing-indicator.show {
            opacity: 1;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #bdc3c7;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .opportunity-card {
            background: #f0f8ff;
            border: 1px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .opportunity-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .opportunity-details {
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.4;
        }

        .opportunity-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .opportunity-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .opportunity-btn:hover {
            background: #2980b9;
        }

        @media (max-width: 768px) {
            .messaging-layout {
                flex-direction: column;
            }
            
            .conversations-sidebar {
                width: 100%;
                height: 200px;
            }
            
            .chat-area {
                height: calc(100vh - 240px);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="bg-white shadow-sm border-b border-gray-200 mb-5" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent">K√°j·ªçp·ªçÃÄ</h1>
                        <p class="ml-3 text-sm text-gray-500 italic">Succeed Together</p>
                    </a>
                </div>
                
                <!-- User Menu -->
                <div id="userMenu" class="relative">
                    <button id="userMenuBtn" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 focus:outline-none">
                        <div class="h-8 w-8 bg-gradient-to-r from-cyan-400 to-purple-500 rounded-full flex items-center justify-center">
                            <span id="userInitials" class="text-white text-sm font-medium"></span>
                        </div>
                        <span id="userName" class="font-medium"></span>
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                        <div class="py-2">
                            <a href="dashboard.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-4 w-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Dashboard
                            </a>

                            <hr class="my-1">
                            <button id="signOutBtn" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-4 w-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Sign Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 80px;"><div class="container">
        <div class="header">
            <h1>üí¨ Messages</h1>
            <div class="header-actions">
                <button class="header-btn" onclick="showNewMessageModal()">‚úâÔ∏è New Message</button>
                <button class="header-btn" onclick="window.location.href='index.html'">üè† Home</button>
            </div>
        </div>

        <div class="messaging-layout">
            <div class="conversations-sidebar">
                <div class="sidebar-header">
                    <input type="text" class="search-box" placeholder="üîç Search conversations..." oninput="filterConversations(this.value)">
                </div>
                
                <div class="conversations-list" id="conversationsList">
                    <div class="conversation-item active" onclick="selectConversation(this, 'sarah-chen')">
                        <div class="conversation-avatar">SC</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Sarah Chen</div>
                            <div class="conversation-preview">Thanks for your interest in the coding bootcamp!</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">2m ago</div>
                            <div class="unread-badge">2</div>
                        </div>
                    </div>
                    
                    <div class="conversation-item" onclick="selectConversation(this, 'mike-johnson')">
                        <div class="conversation-avatar">MJ</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Mike Johnson</div>
                            <div class="conversation-preview">The community garden project sounds amazing...</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">1h ago</div>
                        </div>
                    </div>
                    
                    <div class="conversation-item" onclick="selectConversation(this, 'lisa-rodriguez')">
                        <div class="conversation-avatar">LR</div>
                        <div class="conversation-info">
                            <div class="conversation-name">Lisa Rodriguez</div>
                            <div class="conversation-preview">I'd love to help with the literacy program</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">3h ago</div>
                        </div>
                    </div>
                    
                    <div class="conversation-item" onclick="selectConversation(this, 'david-kim')">
                        <div class="conversation-avatar">DK</div>
                        <div class="conversation-info">
                            <div class="conversation-name">David Kim</div>
                            <div class="conversation-preview">When can we schedule the mentoring session?</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">1d ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-area">
                <div class="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-avatar">SC</div>
                        <div class="chat-user-details">
                            <h3>Sarah Chen</h3>
                            <div class="chat-user-status">
                                <div class="status-dot"></div>
                                Online
                            </div>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-btn">üìû Call</button>
                        <button class="chat-btn">üìπ Video</button>
                        <button class="chat-btn">‚ÑπÔ∏è Info</button>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="message">
                        <div class="message-avatar">SC</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">Hi! I saw your application for the coding bootcamp volunteer position. Your background in JavaScript and Python looks perfect for what we need!</div>
                            </div>
                            <div class="message-time">Yesterday, 2:30 PM</div>
                        </div>
                    </div>

                    <div class="message sent">
                        <div class="message-avatar">You</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">Thank you! I'm really excited about the opportunity to help teach coding skills to underserved communities. When would be a good time to discuss the details?</div>
                            </div>
                            <div class="message-time">Yesterday, 3:15 PM</div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">SC</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">How about we schedule a quick call this week? I can share more about the curriculum and the students you'd be working with.</div>
                                <div class="opportunity-card">
                                    <div class="opportunity-title">üìö Coding Bootcamp Instructor</div>
                                    <div class="opportunity-details">
                                        <strong>Duration:</strong> 3 months<br>
                                        <strong>Time:</strong> Weekends, 4 hours/week<br>
                                        <strong>Skills:</strong> JavaScript, Python, Teaching
                                    </div>
                                    <div class="opportunity-actions">
                                        <button class="opportunity-btn">‚úÖ Accept</button>
                                        <button class="opportunity-btn">üìã View Details</button>
                                    </div>
                                </div>
                            </div>
                            <div class="message-time">Today, 10:20 AM</div>
                        </div>
                    </div>

                    <div class="message sent">
                        <div class="message-avatar">You</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">That sounds perfect! I'm available for a call anytime this week. What days work best for you?</div>
                            </div>
                            <div class="message-time">Today, 11:45 AM</div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">SC</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">Thanks for your interest in the coding bootcamp! I'm really impressed with your background. How about Thursday at 2 PM?</div>
                            </div>
                            <div class="message-time">2 minutes ago</div>
                        </div>
                    </div>

                    <div class="typing-indicator" id="typingIndicator">
                        <div class="message-avatar">SC</div>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>

                <div class="message-input-area">
                    <div class="message-input-container">
                        <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1" oninput="adjustTextareaHeight(this)" onkeypress="handleKeyPress(event)"></textarea>
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>‚û§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentConversation = 'sarah-chen';
        let conversations = {
            'sarah-chen': {
                name: 'Sarah Chen',
                avatar: 'SC',
                status: 'online',
                messages: [
                    { sender: 'them', text: 'Hi! I saw your application for the coding bootcamp volunteer position. Your background in JavaScript and Python looks perfect for what we need!', time: 'Yesterday, 2:30 PM' },
                    { sender: 'me', text: 'Thank you! I\'m really excited about the opportunity to help teach coding skills to underserved communities. When would be a good time to discuss the details?', time: 'Yesterday, 3:15 PM' },
                    { sender: 'them', text: 'How about we schedule a quick call this week? I can share more about the curriculum and the students you\'d be working with.', time: 'Today, 10:20 AM', hasOpportunity: true },
                    { sender: 'me', text: 'That sounds perfect! I\'m available for a call anytime this week. What days work best for you?', time: 'Today, 11:45 AM' },
                    { sender: 'them', text: 'Thanks for your interest in the coding bootcamp! I\'m really impressed with your background. How about Thursday at 2 PM?', time: '2 minutes ago' }
                ]
            },
            'mike-johnson': {
                name: 'Mike Johnson',
                avatar: 'MJ',
                status: 'offline',
                messages: [
                    { sender: 'them', text: 'The community garden project sounds amazing! I\'d love to get involved.', time: '1 hour ago' },
                    { sender: 'me', text: 'Great! We meet every Saturday morning at 9 AM. Would you like to join us this weekend?', time: '45 minutes ago' }
                ]
            },
            'lisa-rodriguez': {
                name: 'Lisa Rodriguez',
                avatar: 'LR',
                status: 'online',
                messages: [
                    { sender: 'them', text: 'I\'d love to help with the literacy program. I have experience teaching reading to children.', time: '3 hours ago' },
                    { sender: 'me', text: 'That\'s wonderful! We could really use someone with your experience. When are you available?', time: '2 hours ago' }
                ]
            },
            'david-kim': {
                name: 'David Kim',
                avatar: 'DK',
                status: 'away',
                messages: [
                    { sender: 'them', text: 'When can we schedule the mentoring session? I\'m excited to get started!', time: '1 day ago' },
                    { sender: 'me', text: 'How about next Tuesday at 3 PM? We can meet at the community center.', time: '1 day ago' }
                ]
            }
        };

        // Initialize message input
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        messageInput.addEventListener('input', () => {
            sendBtn.disabled = messageInput.value.trim() === '';
        });

        function selectConversation(element, conversationId) {
            // Remove active class from all conversations
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected conversation
            element.classList.add('active');
            
            // Remove unread badge
            const badge = element.querySelector('.unread-badge');
            if (badge) {
                badge.remove();
            }
            
            // Update current conversation
            currentConversation = conversationId;
            
            // Load conversation
            loadConversation(conversationId);
        }

        function loadConversation(conversationId) {
            const conversation = conversations[conversationId];
            if (!conversation) return;
            
            // Update chat header
            const chatAvatar = document.querySelector('.chat-avatar');
            const chatName = document.querySelector('.chat-user-details h3');
            const chatStatus = document.querySelector('.chat-user-status');
            
            chatAvatar.textContent = conversation.avatar;
            chatName.textContent = conversation.name;
            
            const statusDot = chatStatus.querySelector('.status-dot');
            const statusText = chatStatus.childNodes[2];
            
            switch(conversation.status) {
                case 'online':
                    statusDot.style.background = '#27ae60';
                    statusText.textContent = ' Online';
                    break;
                case 'away':
                    statusDot.style.background = '#f39c12';
                    statusText.textContent = ' Away';
                    break;
                case 'offline':
                    statusDot.style.background = '#95a5a6';
                    statusText.textContent = ' Offline';
                    break;
            }
            
            // Load messages
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
            
            conversation.messages.forEach(message => {
                const messageDiv = createMessageElement(message);
                messagesContainer.appendChild(messageDiv);
            });
            
            // Add typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.id = 'typingIndicator';
            typingIndicator.innerHTML = `
                <div class="message-avatar">${conversation.avatar}</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesContainer.appendChild(typingIndicator);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sender === 'me' ? 'sent' : ''}`;
            
            let opportunityCard = '';
            if (message.hasOpportunity) {
                opportunityCard = `
                    <div class="opportunity-card">
                        <div class="opportunity-title">üìö Coding Bootcamp Instructor</div>
                        <div class="opportunity-details">
                            <strong>Duration:</strong> 3 months<br>
                            <strong>Time:</strong> Weekends, 4 hours/week<br>
                            <strong>Skills:</strong> JavaScript, Python, Teaching
                        </div>
                        <div class="opportunity-actions">
                            <button class="opportunity-btn" onclick="acceptOpportunity()">‚úÖ Accept</button>
                            <button class="opportunity-btn" onclick="viewOpportunityDetails()">üìã View Details</button>
                        </div>
                    </div>
                `;
            }
            
            const avatar = message.sender === 'me' ? 'You' : conversations[currentConversation].avatar;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="message-text">${message.text}</div>
                        ${opportunityCard}
                    </div>
                    <div class="message-time">${message.time}</div>
                </div>
            `;
            
            return messageDiv;
        }

        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText === '') return;
            
            // Add message to conversation
            const newMessage = {
                sender: 'me',
                text: messageText,
                time: 'Just now'
            };
            
            conversations[currentConversation].messages.push(newMessage);
            
            // Add message to UI
            const messagesContainer = document.getElementById('messagesContainer');
            const typingIndicator = document.getElementById('typingIndicator');
            
            const messageElement = createMessageElement(newMessage);
            messagesContainer.insertBefore(messageElement, typingIndicator);
            
            // Clear input
            messageInput.value = '';
            sendBtn.disabled = true;
            adjustTextareaHeight(messageInput);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Show typing indicator
            setTimeout(() => {
                typingIndicator.classList.add('show');
                
                // Simulate response after 2 seconds
                setTimeout(() => {
                    typingIndicator.classList.remove('show');
                    simulateResponse();
                }, 2000);
            }, 500);
        }

        function simulateResponse() {
            const responses = [
                "That sounds great! I'll send you more details soon.",
                "Perfect! Looking forward to working with you.",
                "Thanks for your quick response. Let me check my calendar.",
                "Excellent! I'll prepare the materials for our meeting.",
                "That works perfectly for me. See you then!"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const responseMessage = {
                sender: 'them',
                text: randomResponse,
                time: 'Just now'
            };
            
            conversations[currentConversation].messages.push(responseMessage);
            
            const messagesContainer = document.getElementById('messagesContainer');
            const typingIndicator = document.getElementById('typingIndicator');
            
            const messageElement = createMessageElement(responseMessage);
            messagesContainer.insertBefore(messageElement, typingIndicator);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            }
        }

        function filterConversations(searchTerm) {
            const conversationItems = document.querySelectorAll('.conversation-item');
            
            conversationItems.forEach(item => {
                const name = item.querySelector('.conversation-name').textContent.toLowerCase();
                const preview = item.querySelector('.conversation-preview').textContent.toLowerCase();
                
                if (name.includes(searchTerm.toLowerCase()) || preview.includes(searchTerm.toLowerCase())) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function showNewMessageModal() {
            alert('New message feature would open a modal to start a new conversation with matched users.');
        }

        function acceptOpportunity() {
            alert('‚úÖ Opportunity accepted! You will receive further instructions via email.');
        }

        function viewOpportunityDetails() {
            alert('üìã This would open a detailed view of the opportunity with full requirements and expectations.');
        }

        // User Menu Functionality
        function checkUserAuth() {
            // Check if user is authenticated (in a real app, this would check session/token)
            const isAuthenticated = localStorage.getItem('userAuthenticated') === 'true';
            const userMenu = document.getElementById('userMenu');
            
            if (isAuthenticated) {
                userMenu.style.display = 'block';
                updateUserInfo();
            } else {
                // Redirect to sign in if not authenticated
                window.location.href = 'signin-form.html';
            }
        }

        function updateUserInfo() {
            // Get user info from localStorage (in a real app, this would come from API)
            const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
            const userName = userInfo.name || 'User';
            const userInitials = userName.split(' ').map(n => n[0]).join('').toUpperCase();
            
            document.getElementById('userName').textContent = userName;
            document.getElementById('userInitials').textContent = userInitials;
        }

        function setupUserMenuListeners() {
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userDropdown = document.getElementById('userDropdown');
            const signOutBtn = document.getElementById('signOutBtn');

            // Toggle dropdown
            userMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                userDropdown.classList.add('hidden');
            });

            // Prevent dropdown from closing when clicking inside
            userDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Sign out functionality
            signOutBtn.addEventListener('click', function() {
                localStorage.removeItem('userAuthenticated');
                localStorage.removeItem('userInfo');
                window.location.href = 'index.html';
            });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            checkUserAuth();
            setupUserMenuListeners();
            loadConversation('sarah-chen');
        });
    </script>
    <!-- Theme Toggle Script -->
    <script src="js/theme-manager.js"></script>
</body>
</html>
