<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Registration Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #444;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Registration Flow Test</h1>
    
    <div class="test-container">
        <h2>Test Controls</h2>
        <button onclick="fillTestData()">Fill Test Data</button>
        <button onclick="submitForm()">Submit Form</button>
        <button onclick="checkFormState()">Check Form State</button>
        <button onclick="testValidation()">Test Validation</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <div class="test-container">
        <h2>Console Output</h2>
        <div id="console"></div>
    </div>
    
    <div class="test-container">
        <h2>Registration Form</h2>
        <iframe id="formFrame" src="registration-form.html"></iframe>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleDiv.textContent += `[${timestamp}] ${message}\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function clearConsole() {
            consoleDiv.textContent = '';
        }
        
        function getFormDocument() {
            const iframe = document.getElementById('formFrame');
            return iframe.contentDocument || iframe.contentWindow.document;
        }
        
        function fillTestData() {
            try {
                log('Filling test data...');
                const doc = getFormDocument();
                
                // Personal Information
                const firstName = doc.getElementById('firstName');
                const lastName = doc.getElementById('lastName');
                const email = doc.getElementById('email');
                const phone = doc.getElementById('phone');
                const location = doc.getElementById('location');
                
                if (firstName) firstName.value = 'John';
                if (lastName) lastName.value = 'Doe';
                if (email) email.value = 'john.doe@test.com';
                if (phone) phone.value = '+1234567890';
                if (location) location.value = 'New York, NY';
                
                // Account Security
                const password = doc.getElementById('password');
                const confirmPassword = doc.getElementById('confirmPassword');
                
                if (password) password.value = 'TestPass123!';
                if (confirmPassword) confirmPassword.value = 'TestPass123!';
                
                // Professional Information
                const currentRole = doc.getElementById('currentRole');
                const organization = doc.getElementById('organization');
                const experience = doc.getElementById('experience');
                const skills = doc.getElementById('skills');
                
                if (currentRole) currentRole.value = 'Software Developer';
                if (organization) organization.value = 'Test Company';
                if (experience) experience.value = '5-10 years';
                if (skills) skills.value = 'JavaScript, Python, React';
                
                // Areas of Interest
                const technology = doc.getElementById('technology');
                if (technology) technology.checked = true;
                
                // Additional Information
                const languages = doc.getElementById('languages');
                const bio = doc.getElementById('bio');
                
                if (languages) languages.value = 'English, Spanish';
                if (bio) bio.value = 'Test bio for registration';
                
                // Terms and conditions
                const terms = doc.getElementById('terms');
                const updates = doc.getElementById('updates');
                
                if (terms) terms.checked = true;
                if (updates) updates.checked = true;
                
                log('Test data filled successfully');
            } catch (error) {
                log('Error filling test data: ' + error.message);
            }
        }
        
        function submitForm() {
            try {
                log('Attempting to submit form...');
                const doc = getFormDocument();
                const submitBtn = doc.querySelector('button[type="submit"]');
                
                if (submitBtn) {
                    log('Found submit button, clicking...');
                    
                    // Add event listener to capture any errors
                    const iframeWindow = doc.defaultView || doc.parentWindow;
                    if (iframeWindow) {
                        // Override console methods to capture logs
                        const originalError = iframeWindow.console.error;
                        iframeWindow.console.error = function(...args) {
                            log('REGISTRATION ERROR: ' + args.join(' '));
                            originalError.apply(iframeWindow.console, args);
                        };
                        
                        // Check if Supabase is available
                        if (iframeWindow.supabaseClient) {
                            log('Supabase client is available');
                        } else {
                            log('WARNING: Supabase client not found!');
                        }
                        
                        // Check if userAuth is available
                        if (iframeWindow.userAuth) {
                            log('UserAuth is available');
                        } else {
                            log('WARNING: UserAuth not found!');
                        }
                    }
                    
                    submitBtn.click();
                } else {
                    log('Submit button not found!');
                }
            } catch (error) {
                log('Error submitting form: ' + error.message);
            }
        }
        
        function checkFormState() {
            try {
                log('Checking form state...');
                const doc = getFormDocument();
                const form = doc.getElementById('registrationForm');
                
                if (form) {
                    log('Form found');
                    const formData = new FormData(form);
                    log('Form data entries:');
                    for (let [key, value] of formData.entries()) {
                        log(`  ${key}: ${value}`);
                    }
                } else {
                    log('Form not found!');
                }
            } catch (error) {
                log('Error checking form state: ' + error.message);
            }
        }
        
        function testValidation() {
            try {
                log('Testing validation...');
                const doc = getFormDocument();
                const win = doc.defaultView || doc.parentWindow;
                
                if (win.formValidator) {
                    log('FormValidator found');
                    const result = win.formValidator.validateForm('registration');
                    log('Validation result: ' + JSON.stringify(result, null, 2));
                } else {
                    log('FormValidator not found!');
                }
            } catch (error) {
                log('Error testing validation: ' + error.message);
            }
        }
        
        // Listen for messages from the iframe
        window.addEventListener('message', function(event) {
            if (event.origin !== window.location.origin) return;
            log('Message from iframe: ' + JSON.stringify(event.data));
        });
        
        // Override console methods in iframe to capture logs
        document.getElementById('formFrame').onload = function() {
            try {
                const iframeWindow = this.contentWindow;
                const originalLog = iframeWindow.console.log;
                const originalError = iframeWindow.console.error;
                const originalWarn = iframeWindow.console.warn;
                
                iframeWindow.console.log = function(...args) {
                    log('IFRAME LOG: ' + args.join(' '));
                    originalLog.apply(iframeWindow.console, args);
                };
                
                iframeWindow.console.error = function(...args) {
                    log('IFRAME ERROR: ' + args.join(' '));
                    originalError.apply(iframeWindow.console, args);
                };
                
                iframeWindow.console.warn = function(...args) {
                    log('IFRAME WARN: ' + args.join(' '));
                    originalWarn.apply(iframeWindow.console, args);
                };
                
                log('Console override setup complete');
            } catch (error) {
                log('Error setting up console override: ' + error.message);
            }
        };
        
        log('Test page loaded and ready');
    </script>
</body>
</html>